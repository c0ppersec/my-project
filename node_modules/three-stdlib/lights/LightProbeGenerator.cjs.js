"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three"),r={fromCubeTexture:function(r){var t,a,o,c=0,n=new e.Vector3,s=new e.Vector3,i=new e.Color,l=[0,0,0,0,0,0,0,0,0],h=new e.SphericalHarmonics3,g=h.coefficients;for(let t=0;t<6;t++){var b=r.image[t],f=b.width,w=b.height,v=document.createElement("canvas");v.width=f,v.height=w;var d=v.getContext("2d");d.drawImage(b,0,0,f,w);var u=d.getImageData(0,0,f,w),S=u.data,m=u.width,p=2/m;for(let h=0,b=S.length;h<b;h+=4){i.setRGB(S[h]/255,S[h+1]/255,S[h+2]/255),"colorSpace"in r?"srgb"===r.colorSpace&&i.convertSRGBToLinear():3001===r.encoding&&i.convertSRGBToLinear();var x=h/4,k=(x%m+.5)*p-1,y=1-(Math.floor(x/m)+.5)*p;switch(t){case 0:n.set(-1,y,-k);break;case 1:n.set(1,y,k);break;case 2:n.set(-k,1,-y);break;case 3:n.set(-k,-1,y);break;case 4:n.set(-k,y,1);break;case 5:n.set(k,y,-1)}a=n.lengthSq(),c+=o=4/(Math.sqrt(a)*a),s.copy(n).normalize(),e.SphericalHarmonics3.getBasisAt(s,l);for(let e=0;e<9;e++)g[e].x+=l[e]*i.r*o,g[e].y+=l[e]*i.g*o,g[e].z+=l[e]*i.b*o}}t=4*Math.PI/c;for(let e=0;e<9;e++)g[e].x*=t,g[e].y*=t,g[e].z*=t;return new e.LightProbe(h)},fromCubeRenderTarget:function(r,t){var a,o,c,n=0,s=new e.Vector3,i=new e.Vector3,l=new e.Color,h=[0,0,0,0,0,0,0,0,0],g=new e.SphericalHarmonics3,b=g.coefficients;for(let a=0;a<6;a++){var f=t.width,w=new Uint8Array(f*f*4);r.readRenderTargetPixels(t,0,0,f,f,w,a);var v=2/f;for(let r=0,g=w.length;r<g;r+=4){l.setRGB(w[r]/255,w[r+1]/255,w[r+2]/255),"colorSpace"in t.texture?"srgb"===t.texture.colorSpace&&l.convertSRGBToLinear():3001===t.texture.encoding&&l.convertSRGBToLinear();var d=r/4,u=(d%f+.5)*v-1,S=1-(Math.floor(d/f)+.5)*v;switch(a){case 0:s.set(1,S,-u);break;case 1:s.set(-1,S,u);break;case 2:s.set(u,1,-S);break;case 3:s.set(u,-1,S);break;case 4:s.set(u,S,1);break;case 5:s.set(-u,S,-1)}o=s.lengthSq(),n+=c=4/(Math.sqrt(o)*o),i.copy(s).normalize(),e.SphericalHarmonics3.getBasisAt(i,h);for(let e=0;e<9;e++)b[e].x+=h[e]*l.r*c,b[e].y+=h[e]*l.g*c,b[e].z+=h[e]*l.b*c}}a=4*Math.PI/n;for(let e=0;e<9;e++)b[e].x*=a,b[e].y*=a,b[e].z*=a;return new e.LightProbe(g)}};exports.LightProbeGenerator=r;
